---
title: "Final_project.Rmd"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(magrittr)  
library(ggplot2)
library(interplot)  
library(dplyr)  
library(devtools)
library(xlsx)
library(knitr)
library(DAAG)
```

#Introduction
The main goal of our reserch is finding variables which affect the student's ability generally through comparison of test scores from differend countries. Especially, we will focus on how inerenet accessibility bring effects on student's ability. 
Recently, some reserchers found that internet accessibility might bring reverse afffect on student's ability because they spend more time on net surfing and gathering information through internet without thinking.

#Methodology
To analyze our research theme, we used the Data from Programme for International Student Assessment(PISA) that conducts assesment about the ......
We picked up the result of **Mathmatics, Reading and Problem Solving** that is conductet in 2012. Also, we picked the result of 2003 Problem solving as well, which is a direct assesment of life competencies that apply across different areas of the school curriculum. This data is benefitial to analyze student's ability that is not measured by academic ability.

Picked up coutries are depended on PISA data avairability,.....

Then, we have analyzed the correlation between these variables.

#Data gathering and merging process
The first dataset is from **PISA**, and the second from **the World Bank**. Both datasets are open and can be found in their respective webpages.

##Data Source
1. PISA: 
We downloaded .... and picked the following three datas up to use as dependent variables:

|Dependent Variable|Variable Name|Description|
|:--------|:------------------|:-----------------------------|
|DV|math|Mathmatics mean score(2012)|
|DV|reading|Readind mean score(2012)|
|DV|ps|Prolem Solving mean score(2012)|

\pagebreak

2. The World Bank:
Taking aveirability into account, we picked the following variables up as explanetory variables from the World Bank Data.

|Indivendent Variable|Variable Name|Description|
|:--------|:---------------|:-------------------------------------------------|
|IV|GDPperc|GDP per Capita (current US$)|
|IV|expend|Government expenditure on education, total (% of GDP)|
|IV|pop|Population, total|
|IV|popd| Population density (people per sq. km of land area)
|IV|rteacher|Primary school pupil-teacher ratio is the average number of pupils per teacher in primary school|
|IV|eyear|Number of years that children are legally obliged to attend school|
|IV|internet|internet users (per 100 people). Internet users are individuals who have used the Internet (from any location) in the last 12 months. Internet can be used via a computer, mobile phone, personal digital assistant, games machine, digital TV etc.|
|IV|mobile|Mobile cellular subscriptions (per 100 people)|

##Cleaned and Merged 
We have cleaned and merged the relevant data of both datasets. Then, we have generate tables and figures to relate the data with the aim of addressing, as well as possible, our researching question to begin to determine whether our hypothesis is correct or not.

```{r , echo=FALSE, comment=NA, warning=FALSE, error=FALSE, message=FALSE, results='asis'}

#For Regression
##Data install
data <- read.xlsx("/Users/komaiyumi/Desktop/Social Sicence/web/Data/PISA_Data.xlsx",1)

##Data Cleaning
cdata <- subset(data, select = c(1,3,4,5,6,7,9,10,12,14,16,17))
cdata <- cdata[,c(1,3,2,4,7,8,9,10,11,12,5,6)]

#For Growth comparison
##Data install
pisa <- read.xlsx("/Users/komaiyumi/Desktop/Social Sicence/web/Data/PISA_Data.xlsx",2)
pisa <- pisa[1:41,]
```

#Multiple Regression
```{r , echo=FALSE, comment=NA, warning=FALSE, error=FALSE, message=FALSE, results='asis'}

##Statistical Discriptions
stargazer(cdata, type="latex",header = FALSE,
          title= 'Summary statistics of the variables',
          font.size='large',out='SD.html')

##Conducting Regression
###Create labels
mlabels <- c('log(GDPperc)', 'log(pop)','popd', 'rteacher', 'eyear', 'expend', 'internet','mobile','(intercept)')

###Math
ma.lm <- lm(math ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear, data = cdata )
ma.lm2 <- lm(math ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend, data = cdata )
ma.lm3 <- lm(math ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + internet + mobile, data = cdata )
ma.lm4 <- lm(math ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend + internet + mobile,data = cdata )


###Create table
stargazer(ma.lm,ma.lm2,ma.lm3,ma.lm4,
          type='latex',header = F, 
          covariate.labels = mlabels,
          out='4ma.text',
          dep.var.labels = 'Math Score',
          title="Table:Regression Estimates of Math Score",
          no.space = TRUE)


###Reading
re.lm <- lm(reading ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear, data = cdata )
re.lm2 <- lm(reading ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend, data = cdata )
re.lm3 <- lm(reading ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + internet + mobile, data = cdata )
re.lm4 <- lm(reading ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend + internet + mobile,data = cdata )

stargazer(re.lm,re.lm2,re.lm3,re.lm4, type='latex',
          header = FALSE, no.space = TRUE,
          out='4re.text',
          covariate.labels = mlabels,
          dep.var.labels = 'Reading Score',
          title="Table:Regression Estimates of Reading Score")

###Problem Solving
ps.lm <- lm(ps ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear, data = cdata )
ps.lm2 <- lm(ps ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend, data = cdata )
ps.lm3 <- lm(ps ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + internet + mobile, data = cdata )
ps.lm4 <- lm(ps ~ log(GDPperc) + log(pop) +  popd + rteacher + eyear + expend + internet + mobile,data = cdata )

stargazer(ps.lm,ps.lm2,ps.lm3,ps.lm4, type ='text',
          header = FALSE, no.space = TRUE,
          out='4ps.text',
          covariate.labels = mlabels,
          dep.var.labels = 'Problem Solving Score',
          title="Table:Regression Estimates of Problem Solving Score")

##Comparison
stargazer(ma.lm,ma.lm2,ma.lm3,ma.lm4,re.lm,re.lm2,re.lm3,re.lm4,ps.lm,ps.lm2,ps.lm3,ps.lm4,
          type='latex', out='allresult.text',
          header = FALSE, no.space =TRUE,
          covariate.labels = mlabels,
          title="Table:Detarminants of Student's Ability",
          font.size='tiny')

stargazer(ma.lm2,ma.lm4,re.lm2,re.lm4,ps.lm2,ps.lm4,
          type='latex', out='comparison 2 result.text',
          header = FALSE, no.space =TRUE,
          covariate.labels = mlabels,
          title="Table:Detarminants of Student's Ability",
          font.size='tiny')

stargazer(ma.lm3,re.lm3,ps.lm3, type='latex',
          header = FALSE, no.space =TRUE,
          covariate.labels = mlabels,
          out="comparison.text",
          title="Table:Regression Estimates of Three Modeles")
```

##Diagnose
```{r , echo=FALSE, comment=NA, warning=FALSE, error=FALSE, message=FALSE, results='asis'}
plot(ma.lm4)

##VIF
v1 <- c('math...............:',vif(ma.lm4))
v2 <- c('reading............:',vif(re.lm4))
v3 <- c('problem solving:',vif(ps.lm4))

stargazer(v1,v2,v3,type='text', header = FALSE, 
          no.space =TRUE, 
          font.size = 'tiny',out='vif.html')

stargazer(vif(ma.lm4),
          type='latex', out='mavif.htlm',
          header = FALSE, no.space =TRUE,
          title='Variance Inflation Factors for Math')

stargazer(vif(re.lm4),
          type='latex', out='revif.htlm',
          header = FALSE, no.space =TRUE,
          title='Variance Inflation Factors for Reading')

stargazer(vif(ps.lm4),
          type='latex', out='psvif.htlm',
          header = FALSE, no.space =TRUE,
          title='Variance Inflation Factors for Problem Soving')

```

##Analysis
According to the result, in the secound regressio, these variables are statistically significant.
- Math:GDP per capita
- Reading: GDP per capita, expenditure
- Problem solving: GDP per capita, population, pupills-teacher rate and duraion educational year in elementary 

In the third regression, GDP per capita is not statistically significant any more. Instead of GDP per capita, the number of internet users and population become statistically significant. 

Especially, the number of internet users is significant at 0.1% level in math and reading. We can see it bring plus effect on the both score.However, regarding the problem solving, internet is statistically significant only at 5 % level and the effect is weaker than other 2 scores.

In addition, regarding GDP per capita of math ane reading, it bring the minues effect on the both scores after the variable internet and mobile are added, though it still bring the plus effect on problem solving. Even though it is not statistically significant for math and reading, but it might possible to infere if the internet accessibility would be the same level, economically strong country's math and reading scores might be lower than economically weak countries.

Also, we noticed that about the academic ability (math and reading,) internet accessibility would bring the some impact on the scores. However, it would bring less impact on the problem solving ability.

Actually, there is some discussion that internet accessibility might bring reverse effect on student's thinkig ability. Therefore, next we focus on the problem solving score.

#Correlation between Problem Solving and Internet
We will do Diagnose about the regresion of Problem solving. The result shows,,,,

```{r , echo=FALSE, comment=NA, warning=FALSE, error=FALSE, message=FALSE, results='asis'}
plot(ps.lm3)
confint(ps.lm3)

### adding the label based on GDP per capita
summary(data$GDPperc)
glabel <- cut(cdata$GDPperc, breaks=c(1754,10690,20580,31350,45720,149200),
    labels=c("low","middle-low","middle","middle-high","high"),
    right=FALSE,include_lowest=TRUE)
lcdata <- transform(cdata,GDPperc_label=glabel)

###correlation between internet and ps score
pplot <- ggplot(lcdata,aes(x=ps,y=internet))+
  geom_point(aes(colour=GDPperc_label))+
    stat_smooth(method="lm")

```


#Analysis about score growth
```{r,echo=FALSE}
##Labeling
summary(pisa$GDPperc)
g2label <- cut(pisa$GDPperc, breaks=c(1754,10690,20580,31350,45720,149200),
    labels=c("low","middle-low","middle","middle-high","high"),
    right=FALSE,include_lowest=TRUE)
lpisa <- transform(pisa,GDPperc_label=g2label)

##Plot and Correlation
###score growth and the number of internet users
p <- ggplot(lpisa, aes(INTERNET.USERS.2012..per.100.people.,Score.growth))+
  geom_point(aes(colour = GDPperc_label))+
  stat_smooth(method="lm")+
  theme_bw()
plot(p)
  
###Growth of the score and the number of internet users growth
p2 <- ggplot(lpisa, aes(Internet.users.growth, Score.growth))+
  geom_point(aes(colour = GDPperc_label))
plot(p2)

```

